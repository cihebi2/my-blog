---
// åŒè¯„è®ºç³»ç»Ÿ - Giscus(GitHubç™»å½•) + åŒ¿åè¯„è®º
import Comments from "@/components/Comments";
---

<div class="mt-8">
  <h3 class="mb-4 text-lg font-semibold text-accent">ğŸ’¬ è¯„è®ºäº¤æµ</h3>
  
  <!-- è¯„è®ºç³»ç»Ÿé€‰æ‹©æ ‡ç­¾ -->
  <div class="mb-6">
    <div class="flex rounded-lg bg-muted p-1" role="tablist">
      <button
        id="tab-github"
        class="flex-1 rounded-md px-3 py-2 text-sm font-medium transition-colors"
        role="tab"
        aria-selected="true"
        data-tab="github"
      >
        ğŸ” GitHubç™»å½•è¯„è®º
      </button>
      <button
        id="tab-anonymous"
        class="flex-1 rounded-md px-3 py-2 text-sm font-medium transition-colors"
        role="tab"
        aria-selected="false"
        data-tab="anonymous"
      >
        ğŸ‘¤ åŒ¿åè¯„è®º
      </button>
    </div>
  </div>

  <!-- GitHubè¯„è®ºåŒºåŸŸ (Giscus) -->
  <div id="github-comments" class="comment-panel">
    <div class="mb-4 rounded-lg bg-blue-50 p-4 text-sm text-blue-800 dark:bg-blue-900/30 dark:text-blue-200">
      <div class="flex items-start gap-2">
        <span class="text-lg">â„¹ï¸</span>
        <div>
          <strong>GitHubç™»å½•è¯„è®º</strong><br/>
          ä½¿ç”¨GitHubè´¦æˆ·ç™»å½•ï¼Œæ”¯æŒä¸°å¯Œçš„Markdownæ ¼å¼ï¼Œè¯„è®ºå°†åŒæ­¥åˆ°GitHub Discussionsã€‚
        </div>
      </div>
    </div>
    <Comments client:only="react" />
  </div>

  <!-- åŒ¿åè¯„è®ºåŒºåŸŸ -->
  <div id="anonymous-comments" class="comment-panel" style="display: none;">
    <div class="mb-4 rounded-lg bg-green-50 p-4 text-sm text-green-800 dark:bg-green-900/30 dark:text-green-200">
      <div class="flex items-start gap-2">
        <span class="text-lg">âœ¨</span>
        <div>
          <strong>åŒ¿åè¯„è®º</strong><br/>
          æ— éœ€ç™»å½•å³å¯å‘è¡¨è¯„è®ºï¼Œæ”¯æŒç•™ä¸‹æ˜µç§°å’Œé‚®ç®±(å¯é€‰)ï¼Œæ›´è½»æ¾çš„è¯„è®ºä½“éªŒã€‚
        </div>
      </div>
    </div>
    
    <!-- ç®€å•çš„åŒ¿åè¯„è®ºè¡¨å• -->
    <div class="space-y-4">
      <form id="anonymous-form" class="space-y-4">
        <div class="grid grid-cols-1 gap-4 sm:grid-cols-2">
          <div>
            <label for="nickname" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
              æ˜µç§° <span class="text-gray-400">(å¯é€‰)</span>
            </label>
            <input
              type="text"
              id="nickname"
              name="nickname"
              placeholder="æ‚¨çš„æ˜µç§°"
              class="mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 text-sm focus:border-accent focus:outline-none focus:ring-1 focus:ring-accent dark:border-gray-600 dark:bg-gray-800 dark:text-white"
            />
          </div>
          <div>
            <label for="email" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
              é‚®ç®± <span class="text-gray-400">(å¯é€‰ï¼Œä¸ä¼šå…¬å¼€)</span>
            </label>
            <input
              type="email"
              id="email"
              name="email"
              placeholder="your@email.com"
              class="mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 text-sm focus:border-accent focus:outline-none focus:ring-1 focus:ring-accent dark:border-gray-600 dark:bg-gray-800 dark:text-white"
            />
          </div>
        </div>
        
        <div>
          <label for="comment" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
            è¯„è®ºå†…å®¹ <span class="text-red-500">*</span>
          </label>
          <textarea
            id="comment"
            name="comment"
            rows="4"
            required
            placeholder="è¯·è¾“å…¥æ‚¨çš„è¯„è®ºå†…å®¹...(æ”¯æŒç®€å•çš„Markdownæ ¼å¼)"
            class="mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 text-sm focus:border-accent focus:outline-none focus:ring-1 focus:ring-accent dark:border-gray-600 dark:bg-gray-800 dark:text-white"
          ></textarea>
        </div>

        <div class="flex items-center justify-between">
          <div class="text-xs text-gray-500">
            <span>ğŸ’¡ æç¤ºï¼šæ”¯æŒ **ç²—ä½“**ã€*æ–œä½“*ã€`ä»£ç ` ç­‰Markdownæ ¼å¼</span>
          </div>
          <button
            type="submit"
            class="rounded-md bg-accent px-4 py-2 text-sm font-medium text-white hover:opacity-90 focus:outline-none focus:ring-2 focus:ring-accent focus:ring-offset-2"
          >
            æäº¤è¯„è®º
          </button>
        </div>
      </form>

      <!-- è¯„è®ºæ˜¾ç¤ºåŒºåŸŸ -->
      <div id="comments-display" class="mt-8">
        <div class="text-center text-gray-500 dark:text-gray-400">
          <p>ğŸŒŸ æš‚æ— åŒ¿åè¯„è®ºï¼Œæ¥å‘è¡¨ç¬¬ä¸€æ¡å§ï¼</p>
          <p class="mt-2 text-xs">è¯„è®ºå°†å­˜å‚¨åœ¨GitHub Issuesä¸­ï¼Œæ‚¨å¯ä»¥éšæ—¶æŸ¥çœ‹å’Œç®¡ç†ã€‚</p>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  // è¯„è®ºç³»ç»Ÿåˆ‡æ¢åŠŸèƒ½
  function initCommentTabs() {
    const githubTab = document.getElementById('tab-github');
    const anonymousTab = document.getElementById('tab-anonymous');
    const githubComments = document.getElementById('github-comments');
    const anonymousComments = document.getElementById('anonymous-comments');

    function switchTab(activeTab: HTMLElement, activePanel: HTMLElement, inactiveTab: HTMLElement, inactivePanel: HTMLElement) {
      // æ›´æ–°æ ‡ç­¾æ ·å¼
      activeTab.classList.add('bg-background', 'text-accent', 'shadow-sm');
      activeTab.classList.remove('text-muted-foreground');
      activeTab.setAttribute('aria-selected', 'true');
      
      inactiveTab.classList.remove('bg-background', 'text-accent', 'shadow-sm');
      inactiveTab.classList.add('text-muted-foreground');
      inactiveTab.setAttribute('aria-selected', 'false');

      // åˆ‡æ¢é¢æ¿æ˜¾ç¤º
      activePanel.style.display = 'block';
      inactivePanel.style.display = 'none';
    }

    githubTab?.addEventListener('click', () => {
      if (githubTab && githubComments && anonymousTab && anonymousComments) {
        switchTab(githubTab, githubComments, anonymousTab, anonymousComments);
      }
    });

    anonymousTab?.addEventListener('click', () => {
      if (anonymousTab && anonymousComments && githubTab && githubComments) {
        switchTab(anonymousTab, anonymousComments, githubTab, githubComments);
      }
    });

    // åˆå§‹çŠ¶æ€
    githubTab?.classList.add('bg-background', 'text-accent', 'shadow-sm');
    anonymousTab?.classList.add('text-muted-foreground');
  }

  // åŒ¿åè¯„è®ºæäº¤åŠŸèƒ½
  function initAnonymousComments() {
    const form = document.getElementById('anonymous-form') as HTMLFormElement;
    form?.addEventListener('submit', async (e: Event) => {
      e.preventDefault();
      
      const formData = new FormData(form);
      // const nickname = formData.get('nickname') || 'åŒ¿åç”¨æˆ·'; // æš‚æ—¶æœªä½¿ç”¨ï¼Œæ³¨é‡Šä»¥æ¶ˆé™¤è­¦å‘Š
      const comment = formData.get('comment');

      if (!comment || typeof comment !== 'string' || !comment.trim()) {
        alert('è¯·è¾“å…¥è¯„è®ºå†…å®¹');
        return;
      }

      // è¿™é‡Œæ‚¨å¯ä»¥é›†æˆçœŸå®çš„è¯„è®ºæäº¤é€»è¾‘
      // ä¾‹å¦‚ï¼šæäº¤åˆ°GitHub Issues APIã€ç¬¬ä¸‰æ–¹æœåŠ¡ç­‰
      
      // ä¸´æ—¶æ˜¾ç¤ºæäº¤æˆåŠŸ
      const submitBtn = form.querySelector('button[type="submit"]') as HTMLButtonElement;
      if (submitBtn) {
        const originalText = submitBtn.textContent;
        submitBtn.textContent = 'æäº¤ä¸­...';
        submitBtn.disabled = true;

        setTimeout(() => {
          alert('è¯„è®ºæäº¤æˆåŠŸï¼æ„Ÿè°¢æ‚¨çš„åé¦ˆã€‚\n\næ³¨æ„ï¼šè¿™æ˜¯æ¼”ç¤ºç‰ˆæœ¬ï¼Œå®é™…éƒ¨ç½²æ—¶éœ€è¦é…ç½®åç«¯æœåŠ¡æ¥å¤„ç†è¯„è®ºå­˜å‚¨ã€‚');
          form.reset();
          if (submitBtn) {
            submitBtn.textContent = originalText;
            submitBtn.disabled = false;
          }
        }, 1000);
      }
    });
  }

  // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
  document.addEventListener('DOMContentLoaded', () => {
    initCommentTabs();
    initAnonymousComments();
  });
</script>

<style>
  .comment-panel {
    min-height: 200px;
  }
  
  /* å¹³æ»‘è¿‡æ¸¡åŠ¨ç”» */
  .comment-panel {
    transition: opacity 0.2s ease-in-out;
  }
  
  /* è¡¨å•æ ·å¼ä¼˜åŒ– */
  input:focus, textarea:focus {
    box-shadow: 0 0 0 3px rgba(var(--color-accent-rgb), 0.1);
  }
</style> 